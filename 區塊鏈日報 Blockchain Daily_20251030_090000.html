<!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <title>Youtube频道：區塊鏈日報 Blockchain Daily</title>
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <style>
            .chart-container {
                width: 1000px;
                height: 600px;
                margin: 30px auto;
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 10px;
            }
            .stats-header {
                text-align: center;
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
            }
            .chart-controls {
                 /* 使用 Flexbox 布局 */
                display: flex;
                /* 将子元素对齐到两端，第一个在左，最后一个在右 */
                justify-content: space-between;
                align-items: center; /* 垂直居中对齐 */
                margin-bottom: 10px;
                padding: 0 5px; /* 添加一些内边距，防止贴边 */
            }
            .chart-controls button {
                padding: 5px 10px;
                cursor: pointer;
                border: 1px solid #ccc;
                background-color: #f9f9f9;
                border-radius: 3px;
            }
        </style>
    </head>
    <body>
        <div class="stats-header">Youtube频道：區塊鏈日報 Blockchain Daily</div>

        <div class="chart-container">
            <div class="chart-controls">
                <span id="viewCountChartType">柱形图</span>
                <div>
                    <button onclick="changeChartType('viewCountChart', 'bar', '柱形图')">柱形图</button>
                    <button onclick="changeChartType('viewCountChart', 'line', '折线图')">折线图</button>
                </div>
            </div>
            <div style="width: 100%; height: calc(100% - 30px);" id="viewCountChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-controls">
                <span id="subscriberCountChartType">柱形图</span>
                <div>
                    <button onclick="changeChartType('subscriberCountChart', 'bar', '柱形图')">柱形图</button>
                    <button onclick="changeChartType('subscriberCountChart', 'line', '折线图')">折线图</button>
                </div>
            </div>
            <div style="width: 100%; height: calc(100% - 30px);" id="subscriberCountChart"></div>
        </div>

        <script>
            // 初始化ECharts实例
            var viewCountChartDom = document.getElementById('viewCountChart');
            var viewCountChart = echarts.init(viewCountChartDom);
            var subscriberCountChartDom = document.getElementById('subscriberCountChart');
            var subscriberCountChart = echarts.init(subscriberCountChartDom);

            // 使用Python传递过来的JSON数据
            var viewCountData = [];

            // 准备图表数据
            var viewCountXAxisData = [];
            var viewCountSeriesData = [];
            var subscriberCountXAxisData = ['2025-09-22', '2025-09-23', '2025-09-24', '2025-09-25', '2025-09-26', '2025-09-27', '2025-09-28', '2025-09-29', '2025-09-30', '2025-10-01', '2025-10-02', '2025-10-03', '2025-10-04', '2025-10-05', '2025-10-06', '2025-10-07', '2025-10-08', '2025-10-09', '2025-10-10', '2025-10-11', '2025-10-12', '2025-10-13', '2025-10-14', '2025-10-15', '2025-10-16', '2025-10-17', '2025-10-18', '2025-10-19', '2025-10-19', '2025-10-20', '2025-10-20', '2025-10-21', '2025-10-22', '2025-10-23', '2025-10-24', '2025-10-25', '2025-10-26', '2025-10-27', '2025-10-28', '2025-10-29'];
            var subscriberCountSeriesData = [225, 62, 200, 199, 79, 178, 290, 66, 178, 178, 225, 186, 186, 186, 186, 86, 158, 167, 166, 167, 397, 216, 216, 582, 167, 296, 295, 440, 574, 336, 202, 335, 36, 35, 36, -65, 36, 35, -64, 35];

            // 定义一个函数来改变图表类型
            function changeChartType(chartId, type, typeText) {
                // 根据 ID 获取 ECharts 实例
                var chartInstance = echarts.getInstanceByDom(document.getElementById(chartId));
                if (chartInstance) {
                    // 获取当前配置，并进行深拷贝，避免直接修改原始配置
                    var currentOption = chartInstance.getOption();
                    var newOption = JSON.parse(JSON.stringify(currentOption));

                    // 仅修改 series 的 type
                    newOption.series[0].type = type;

                    // 根据图表类型调整特定配置
                    if (type === 'line') {
                        // 折线图
                        newOption.series[0].smooth = true;
                        newOption.series[0].symbol = 'circle';
                        newOption.series[0].symbolSize = 8;
                        newOption.series[0].itemStyle = {
                            color: '#6A5ACD'
                        };
                    } else {
                        // 柱形图
                        newOption.series[0].smooth = false;
                        newOption.series[0].symbol = 'none';
                        newOption.series[0].symbolSize = 0;

                        // 重新设置柱形图的动态颜色函数
                        if (chartId === 'viewCountChart') {
                            newOption.series[0].itemStyle.color = function(params) {
                                var value = params.value;
                                if (value > 500000) return '#8B0000';  // 极高热
                                if (value > 200000) return '#DC143C';  // 超高热
                                if (value > 100000) return '#FF4500';  // 高热
                                if (value > 50000) return '#FF8C00';  // 中高热
                                if (value > 20000) return '#FFA500';  // 中热
                                if (value > 10000) return '#FFD700';  // 中低热
                                if (value > 5000) return '#32CD32';  // 一般
                                if (value > 1000)  return '#1E90FF';  // 较低
                                return '#B0C4DE';     // 冷门
                            };
                        } else if (chartId === 'subscriberCountChart') {
                            newOption.series[0].itemStyle.color = function(params) {
                                var value = params.value;
                                if (value > 1000) return '#FF4500';  // 高热
                                if (value > 500) return '#FF8C00';  // 中热
                                if (value > 200) return '#32CD32';   // 一般
                                return '#1E90FF';                     // 较低
                            };
                        }
                    }

                    chartInstance.setOption(newOption, true);
                    document.getElementById(chartId + 'Type').innerText = typeText;
                }
            }

            // 初始配置和渲染图表
            var viewCountOption = {
                title: {
                    text: '每日视频播放量统计',
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        var dataIndex = params[0].dataIndex;
                        var videoItem = viewCountData[dataIndex];
                        return '视频标题: ' + videoItem.title + '<br/>' +
                               '发布日期: ' + videoItem.published_at + '<br/>' +
                               '播放量: ' + videoItem.viewCount.toLocaleString();
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: viewCountXAxisData,
                    axisLabel: {
                        interval: 0,
                        rotate: 45,
                        fontSize: 10
                    },
                    name: '发布日期',
                    nameLocation: 'end'
                },
                yAxis: {
                    type: 'value',
                    name: '播放量',
                    nameTextStyle: {
                        fontWeight: 'bold'
                    },
                    axisLabel: {
                        show: false
                    }
                },
                series: [{
                    name: '播放量',
                    type: 'bar',
                    data: viewCountSeriesData,
                    itemStyle: {
                        color: function(params) {
                            var value = params.value;
                            if (value > 500000) return '#8B0000';
                            if (value > 200000) return '#DC143C';
                            if (value > 100000) return '#FF4500';
                            if (value > 50000) return '#FF8C00';
                            if (value > 20000) return '#FFA500';
                            if (value > 10000) return '#FFD700';
                            if (value > 5000) return '#32CD32';
                            if (value > 1000)  return '#1E90FF';
                            return '#B0C4DE';
                        }
                    },
                    label: {
                        show: false,
                        position: 'top',
                        formatter: function(params) {
                            return params.value.toLocaleString();
                        }
                    }
                }],
                dataZoom: [{
                    type: 'inside',
                    start: 0,
                    end: 100
                }, {
                    type: 'slider',
                    start: 0,
                    end: 100
                }]
            };
            viewCountChart.setOption(viewCountOption);

            var subscriberCountOption = {
                title: {
                    text: '每日新增订阅数',
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: subscriberCountXAxisData,
                    axisLabel: {
                        interval: 0,
                        rotate: 45,
                        fontSize: 10
                    },
                    name: '日期',
                    nameLocation: 'end'
                },
                yAxis: {
                    type: 'value',
                    name: '新增订阅数',
                    nameTextStyle: {
                        fontWeight: 'bold'
                    }
                },
                series: [{
                    name: '新增订阅数',
                    type: 'bar',
                    data: subscriberCountSeriesData,
                    itemStyle: {
                        color: function(params) {
                            var value = params.value;
                            if (value > 1000) return '#FF4500';
                            if (value > 500) return '#FF8C00';
                            if (value > 200) return '#32CD32';
                            return '#1E90FF';
                        }
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return params.value;
                        }
                    }
                }],
                 dataZoom: [{
                    type: 'inside',
                    start: 0,
                    end: 100
                }, {
                    type: 'slider',
                    start: 0,
                    end: 100
                }]
            };
            subscriberCountChart.setOption(subscriberCountOption);

            // 响应窗口大小变化
            window.addEventListener('resize', function() {
                viewCountChart.resize();
                subscriberCountChart.resize();
            });
        </script>
    </body>
    </html>